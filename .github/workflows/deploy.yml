  name: Deploy to VPS

  on:
    push:
      branches: [main]

  jobs:
    deploy:
      runs-on: ubuntu-latest
      steps:
        - uses: actions/checkout@v4

        - name: Deploy via rsync
          env:
            SSH_KEY: ${{ secrets.VPS_SSH_KEY }}
          run: |
            mkdir -p ~/.ssh
            echo "$SSH_KEY" > ~/.ssh/deploy_key
            chmod 600 ~/.ssh/deploy_key
            ssh-keyscan -H ${{ secrets.VPS_HOST }} >> ~/.ssh/known_hosts

            rsync -avz --delete \
              -e "ssh -i ~/.ssh/deploy_key" \
              --exclude='.git' \
              --exclude='.github' \
              --exclude='README.md' \
              --exclude='logo_designs.png' \
              ./ ${{ secrets.VPS_USER }}@${{ secrets.VPS_HOST }}:/var/www/aidoo.biz/
